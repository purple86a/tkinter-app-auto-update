<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs">
  <!-- 
    WiX 6.x Setup for MyApp 
    This file defines the MSI package structure.
    Files are harvested from the Nuitka standalone output folder.
  -->
  
  <Package Name="MyApp" 
           Manufacturer="YourCompany" 
           Version="$(var.Version)" 
           UpgradeCode="4f5e6d7c-8b9a-0d1e-2f3a-4b5c6d7e8f9a"
           Scope="perMachine"
           InstallerVersion="500"
           Language="1033">

    <MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed." 
                  Schedule="afterInstallInitialize" />

    <!-- Define the media (CAB file embedded in MSI) -->
    <MediaTemplate EmbedCab="yes" />

    <!-- Install to Program Files\MyApp -->
    <StandardDirectory Id="ProgramFiles6432Folder">
      <Directory Id="INSTALLFOLDER" Name="MyApp" />
    </StandardDirectory>

    <!-- Start Menu shortcut folder -->
    <StandardDirectory Id="ProgramMenuFolder">
      <Directory Id="ApplicationProgramsFolder" Name="MyApp" />
    </StandardDirectory>

    <!-- Start Menu Shortcut -->
    <ComponentGroup Id="ShortcutComponents" Directory="ApplicationProgramsFolder">
      <Component Id="StartMenuShortcut" Guid="c3d4e5f6-a7b8-9012-cdef-345678901234">
        <Shortcut Id="ApplicationStartMenuShortcut"
                  Name="MyApp"
                  Description="MyApp Application"
                  Target="[INSTALLFOLDER]main.exe"
                  WorkingDirectory="INSTALLFOLDER" />
        <RemoveFolder Id="CleanUpShortcutFolder" On="uninstall" />
        <RegistryValue Root="HKCU" Key="Software\YourCompany\MyApp" Name="StartMenuShortcut" Type="integer" Value="1" KeyPath="yes" />
      </Component>
    </ComponentGroup>

    <!-- Feature definition - HarvestedFiles comes from harvested.wxs -->
    <Feature Id="MainFeature" Title="MyApp" Level="1">
      <ComponentGroupRef Id="HarvestedFiles" />
      <ComponentGroupRef Id="ShortcutComponents" />
    </Feature>

  </Package>
</Wix>
