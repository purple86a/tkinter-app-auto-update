<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs">
  <!-- 
    WiX 6.x Setup for MyApp 
    This file defines the MSI package structure.
  -->
  
  <Package Name="MyApp" 
           Manufacturer="YourCompany" 
           Version="$(var.Version)" 
           UpgradeCode="4f5e6d7c-8b9a-0d1e-2f3a-4b5c6d7e8f9a"
           Scope="perUser"
           Language="1033">

    <MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed." />

    <!-- Define the media (CAB file embedded in MSI) -->
    <MediaTemplate EmbedCab="yes" />

    <!-- Define the folder structure -->
    <StandardDirectory Id="LocalAppDataFolder">
      <Directory Id="ProgramsFolder" Name="Programs">
        <Directory Id="INSTALLFOLDER" Name="MyApp" />
      </Directory>
    </StandardDirectory>

    <StandardDirectory Id="StartMenuFolder">
      <Directory Id="ApplicationProgramsFolder" Name="MyApp" />
    </StandardDirectory>

    <!-- Define the components -->
    <ComponentGroup Id="ProductComponents" Directory="INSTALLFOLDER">
      <!-- The main executable -->
      <Component Id="MainExecutable" Guid="a1b2c3d4-e5f6-7890-abcd-ef1234567890">
        <File Id="MyAppEXE" Source="dist\main.dist\main.exe" KeyPath="yes">
          <Shortcut Id="StartMenuShortcut"
                    Directory="ApplicationProgramsFolder"
                    Name="MyApp"
                    WorkingDirectory="INSTALLFOLDER"
                    Advertise="yes" />
        </File>
        <RemoveFolder Id="CleanupShortcut" Directory="ApplicationProgramsFolder" On="uninstall" />
        <RegistryValue Root="HKCU" Key="Software\YourCompany\MyApp" Name="installed" Type="integer" Value="1" />
      </Component>

      <!-- The rest of the Nuitka output (if standalone folder) -->
      <!-- In common scenarios, you might use harvest (heat) but for a simple app we list dependencies if any -->
      <!-- Since Nuitka creates a .dist folder, we ideally want to include everything in it -->
    </ComponentGroup>

    <!-- Feature definition -->
    <Feature Id="MainFeature" Title="MyApp" Level="1">
      <ComponentGroupRef Id="ProductComponents" />
    </Feature>

  </Package>
</Wix>
